<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <title>Nathan Catania | Installing Docker CE on Red Hat with no internet access</title>
  
  <meta name="description" content="The free Docker CE is not compatible with RHEL, so how can we install it, resolve dependencies, and transfer images - all on a RHEL server with no internet access?">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Installing Docker CE on Red Hat with no internet access">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://localhost:4000/posts/installing-docker-on-red-hat-with-no-internet-access">
  <meta property="og:description" content="The free Docker CE is not compatible with RHEL, so how can we install it, resolve dependencies, and transfer images - all on a RHEL server with no internet access?">
  <meta property="og:site_name" content="Nathan Catania">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://localhost:4000/posts/installing-docker-on-red-hat-with-no-internet-access">
  <meta name="twitter:title" content="Installing Docker CE on Red Hat with no internet access">
  <meta name="twitter:description" content="The free Docker CE is not compatible with RHEL, so how can we install it, resolve dependencies, and transfer images - all on a RHEL server with no internet access?">

  
    <meta property="og:image" content="http://localhost:4000/assets/og-image-226cb427b00014bffc4473c892a2f50e3891290cea42d16cf0e4480ef323507f.jpg">
    <meta name="twitter:image" content="http://localhost:4000/assets/og-image-226cb427b00014bffc4473c892a2f50e3891290cea42d16cf0e4480ef323507f.jpg">
  

  <link href="http://localhost:4000/feed.xml" type="application/rss+xml" rel="alternate" title="Nathan Catania Last 10 blog posts" />

  

  
    <link rel="icon" type="image/x-icon" href="/assets/favicon-light-0fb75e705f4c26badaa4bcdef43cb502633cccf890a2000e372ed03fb65ffdb4.ico">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon-light-3d53a961ad5a122e83b8efada7f6b8eef7586b54e4bbfc404e98401321b1aeb6.png">
    <link rel="stylesheet" type="text/css" href="/assets/light-45af32a332797ff21ace7ee99c6bddf2d69d2895713f16709a39a9ecbd2276df.css">
  
</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="Nathan Catania">Nathan Catania</a>
  <ul class="header-links">
    
    
    
    
    
      <li>
        <a href="https://github.com/nathancatania" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
      <li>
        <a href="https://hub.docker.com/r/nathancatania" rel="noreferrer noopener" target="_blank" title="Docker Hub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-docker">
  <use href="/assets/docker-c339e74d6b786fbde73b16d23c150b731f34e6afba1693051596237af7ff9f2d.svg#icon-docker" xlink:href="/assets/docker-c339e74d6b786fbde73b16d23c150b731f34e6afba1693051596237af7ff9f2d.svg#icon-docker"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://www.linkedin.com/in/nathancatania" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:nathan@nathancatania.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss" xlink:href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>

        <article class="article scrollappear">
          <header class="article-header">
            <h1>Installing Docker CE on Red Hat with no internet access</h1>
            <p>The free Docker CE is not compatible with RHEL, so how can we install it, resolve dependencies, and transfer images - all on a RHEL server with no internet access?</p>
            <div class="article-list-footer">
              <span class="article-list-date">
                November 30, 2017
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  5 minute read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/tag/guides">guides</a>
                
                  <a href="/tag/docker">docker</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <h2 id="introduction">Introduction</h2>
<p>I recently completed a deployment inside a customer’s lab involving several containerized services, in which the server instances provided were not permitted to have direct access to the internet. To add to the issue, the instances themselves were running RHEL 7.3 with no active subscription.</p>

<p>There were several problems in play here:</p>

<ol>
  <li>Docker only make their Enterprise Edition (EE) compatible with RHEL. The usual free Community Edition (CE) is not officially supported.</li>
  <li>Attempting to circumvent #1 by installing the RPM for Centos resulted in dependency issues.</li>
  <li>Normally these dependency issues would be trivial to resolve with internet access, however in this case, no internet access was available on the instances.</li>
  <li>Attempting to manually download the dependencies on another machine and transfer them to the servers resulted in more dependency issues (it was a tree of dependencies!)</li>
  <li>How can the required container images be pulled with no internet access?</li>
</ol>

<p>The below writeup should cover the solution to all of these issues, so no matter what your issue is - I hope this is useful to you.</p>

<p><em>As always, proceed at your own risk. I will not be held responsible for any problems that result as a result of you following this guide.</em></p>

<hr />

<h2 id="part-1---configuring-a-local-repository">Part 1 - Configuring a local repository</h2>
<p><em>Skip this step if you have internet access on your target server as any issues with dependencies should resolve themselves automatically.</em></p>

<p>To resolve the dependency issues on RHEL, we are going to create a local Yum repository from the Red Hat installation media which contains resolutions to our dependency issues.</p>

<h3 id="1-download-the-rhel-iso">1. Download the RHEL ISO</h3>
<ul>
  <li>Download the RHEL ISO for your applicable version (7.2, 7.3 etc).</li>
  <li>RHEL ISOs can be downloaded from the <a href="https://www.gitbook.com/book/nathancatania/telemetry-backbone-installation/edit#">RedHat developer page</a> (free account required).</li>
  <li>You can use the below command to check your version if unsure:</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nb">cat</span> /etc/redhat-release</code></pre></figure>

<h3 id="2-copy-the-iso-to-the-required-servers">2. Copy the ISO to the required servers</h3>
<ul>
  <li>The ISO will need to be copied to all the servers which Docker is to be installed on.</li>
</ul>

<p>Example:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">scp rhel-server-7.X-x86_64-dvd.iso &lt;user&gt;@&lt;<span class="nb">hostname</span><span class="o">&gt;</span>:</code></pre></figure>

<h3 id="3-mount-the-iso">3. Mount the ISO</h3>
<ul>
  <li>Mount the ISO on your target server:</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">mount <span class="nt">-o</span> loop rhel-server-7.X-x86_64-dvd.iso /mnt</code></pre></figure>

<h3 id="4-copy-the-repository-locally">4. Copy the repository locally</h3>
<ul>
  <li>Copy the repository from the mounted ISO and set the correct permissions.</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nb">cp</span> /mnt/media.repo /etc/yum.repos.d/rhel7dvd.repo
<span class="nb">chmod </span>644 /etc/yum.repos.d/rhel7dvd.repo</code></pre></figure>

<h3 id="5-edit-the-repo-file">5. Edit the repo file</h3>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">vi /etc/yum.repos.d/rhel7dvd.repo</code></pre></figure>

<p><em>If you haven’t used vi before, press <code class="highlighter-rouge">a</code> to enter edit mode, <code class="highlighter-rouge">ESC</code> to exit edit mode, and <code class="highlighter-rouge">:wq</code> to save and quit.</em></p>

<ul>
  <li>Change the <code class="highlighter-rouge">gpgcheck=0</code> parameter to <code class="highlighter-rouge">1</code>.</li>
  <li>Add the following 3 lines to the end of file (but before the <code class="highlighter-rouge">~</code> characters in the editor):</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nv">enabled</span><span class="o">=</span>1
<span class="nv">baseurl</span><span class="o">=</span>file:///mnt/
<span class="nv">gpgkey</span><span class="o">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release</code></pre></figure>

<p>Save and exit vi.</p>

<h3 id="6-clean-the-repositories">6. Clean the repositories</h3>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">yum clean all <span class="o">&amp;&amp;</span> subscription-manager clean</code></pre></figure>

<h3 id="7-verify-the-repo-works">7. Verify the repo works</h3>
<p>This should generate a very long packages list if working correctly.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">yum  <span class="nt">--noplugins</span> list</code></pre></figure>

<hr />

<h2 id="part-2---installing-docker-ce">Part 2 - Installing Docker CE</h2>
<p>Attempting to install the RPM for Centos will fail due to a missing dependency. In this part, we will download Docker CE and the dependency manually and install.</p>

<h3 id="1-download-the-docker-ce-rpm-for-centos">1. Download the Docker CE RPM for Centos</h3>
<p><em><strong>Note 1:</strong> At the time of this post, Docker 17.09.0 CE was the latest version available for Centos. You may wish to check for a more up-to-date version if applicable.</em></p>

<p><em><strong>Note 2:</strong> The Container SELinux dependency below was for RHEL 7.3. Your version may differ. Please confirm before proceeding.</em>
On your internet-enabled machine, download the Docker 17.09.0 CE package and its dependency.</p>

<p>If your instance does not have internet access, you will need to complete this step on a connected machine and then transfer the files across.</p>

<p>Docker CE:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">curl https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-17.09.0.ce-1.el7.centos.x86_64.rpm <span class="nt">-o</span> docker.rpm</code></pre></figure>

<p>Dependency:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">curl http://mirror.centos.org/centos/7.3.1611/extras/x86_64/Packages/container-selinux-2.9-4.el7.noarch.rpm <span class="nt">-o</span> containerselinux.rpm</code></pre></figure>

<h3 id="2-install">2. Install</h3>
<p>Make sure to run the command with both RPMs in the specific order below! The dependency should be installed first!</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">yum <span class="nb">install</span> <span class="nt">-y</span> containerselinux.rpm docker.rpm</code></pre></figure>

<p>If the above command succeeds: congratulations! You have successfully installed Docker CE on Red Hat!</p>

<h3 id="3-optional-start-docker">3. [OPTIONAL] Start Docker</h3>
<p>Start Docker and set it to start at boot.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">systemctl start docker
systemctl <span class="nb">enable </span>docker</code></pre></figure>

<hr />
<h2 id="part-3---transferring-docker-images">Part 3 - Transferring Docker images</h2>
<p><em>This step is not required if you have internet access available on your server</em></p>

<p>Now that Docker is installed, there is the issue of: how do we actually get our Docker images onto the server if there is no internet access available?</p>

<p>The answer is: You will pull the images on another (internet-connected) machine with Docker, save the images, and then transfer them across to your server. Docker will always attempt to use a local image <strong>first</strong> before pulling the image from a remote repo.</p>

<h3 id="1-pull-the-required-docker-images">1. Pull the required Docker images</h3>
<p>In this example, we will be pulling the images for both Zookeeper and Kafka (your images might differ).</p>

<p>On an internet-enabled machine with Docker installed, run the following:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker pull my_docker_image
save <span class="nt">-o</span> my_docker_image.docker my_docker_image</code></pre></figure>

<p>Replacing <code class="highlighter-rouge">my_docker_image</code> with the same of the image you want to pull and save.</p>

<p>For example, for both Kafka and Zookeeper:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker pull wurstmeister/zookeeper
docker pull wurstmeister/kafka:latest
docker save <span class="nt">-o</span> zookeeper_image.docker wurstmeister/zookeeper
docker save <span class="nt">-o</span> kafka_image.docker wurstmeister/kafka</code></pre></figure>

<p>Copy the <code class="highlighter-rouge">.docker</code> file(s) you saved across to your target server.</p>

<h3 id="2-load-the-docker-images">2. Load the Docker images</h3>
<p>On your target (non-internet connected) server, load the Docker images into inventory with:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker load <span class="nt">-i</span> my_image_name</code></pre></figure>

<p>For example, again for both Kafka and Zookeeper:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">docker load <span class="nt">-i</span> kafka_image.docker
docker load <span class="nt">-i</span> zookeeper_image.docker</code></pre></figure>

<h3 id="3-done">3. Done!</h3>
<p>You can now use Docker as you normally would with the images loaded above.</p>


          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Installing+Docker+CE+on+Red+Hat+with+no+internet+access%20-%20http://localhost:4000/posts/installing-docker-on-red-hat-with-no-internet-access" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/posts/installing-docker-on-red-hat-with-no-internet-access" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
            <a href="https://plus.google.com/share?url=http://localhost:4000/posts/installing-docker-on-red-hat-with-no-internet-access" title="Share on Google+" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 128 128"><path d="M40.7 55.9v16.1c0 0 15.6 0 22 0C59.2 82.5 53.8 88.2 40.7 88.2c-13.3 0-23.7-10.8-23.7-24.2s10.4-24.2 23.7-24.2c7.1 0 11.6 2.5 15.8 5.9 3.3-3.3 3.1-3.8 11.6-11.9 -7.2-6.6-16.8-10.6-27.4-10.6C18.2 23.3 0 41.5 0 64c0 22.5 18.2 40.7 40.7 40.7 33.6 0 41.8-29.3 39-48.8H40.7zM113.9 56.7V42.6h-10.1v14.1H89.4v10.1h14.5v14.5h10.1V66.8H128V56.7H113.9z"/></svg>
            </a>
          </div>

          
        </article>
        <footer class="footer scrollappear">
  <p>
    &copy; 2018, Nathan Catania<br>
    Created with Jekyll using the <a href="https://github.com/nielsenramon/chalk" rel="noreferrer noopener" target="_blank" title="Chalk">Chalk</a> theme.
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-91639797-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-91639797-1');
  </script>


<script type="text/javascript" src="/assets/vendor-2e5becc015a837c852edabccbc32f5a390d4afa7a2ca601db948ea5b9e50292a.js"></script>


  <script type="text/javascript" src="/assets/webfonts-4befe84fc0cb70d216d9e377f75b95b2fa39c07423839b117b09f1d958d5627b.js"></script>



  <script type="text/javascript" src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js"></script>


<script type="text/javascript" src="/assets/application-cd43a7f9bd8a08997bb19229cd040e7129ede0a1adf77c693b5835c9f8c2a4b1.js"></script>

</body>
</html>
