<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <title>Nathan Catania | Deploying ZPA ZEN Connectors</title>
  
  <meta name="description" content="These notes will cover how to deploy a ZEN Connector for Zscaler Private Access (ZPA)">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Deploying ZPA ZEN Connectors">
  <meta property="og:type" content="website">
  <meta property="og:url" content="nathancatania.com/posts/deploying-zpa-zen-connectors">
  <meta property="og:description" content="These notes will cover how to deploy a ZEN Connector for Zscaler Private Access (ZPA)">
  <meta property="og:site_name" content="Nathan Catania">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="nathancatania.com/posts/deploying-zpa-zen-connectors">
  <meta name="twitter:title" content="Deploying ZPA ZEN Connectors">
  <meta name="twitter:description" content="These notes will cover how to deploy a ZEN Connector for Zscaler Private Access (ZPA)">

  
    
      <meta property="og:image" content="nathancatania.com/assets/2020-01-05-deploying-zpa-zen-connectors.assets/banner-25bc607c2b7cbebce4ac497b8d111ed330c87a88de5cbf432a801604bb9f7b2f.png">
      <meta name="twitter:image" content="nathancatania.com/assets/2020-01-05-deploying-zpa-zen-connectors.assets/banner-25bc607c2b7cbebce4ac497b8d111ed330c87a88de5cbf432a801604bb9f7b2f.png">
    
  

  <link href="nathancatania.com/feed.xml" type="application/rss+xml" rel="alternate" title="Nathan Catania Last 10 blog posts" />

  

  
    <link rel="icon" type="image/x-icon" href="/assets/favicon-light-0fb75e705f4c26badaa4bcdef43cb502633cccf890a2000e372ed03fb65ffdb4.ico">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon-light-3d53a961ad5a122e83b8efada7f6b8eef7586b54e4bbfc404e98401321b1aeb6.png">
    <link rel="stylesheet" type="text/css" href="/assets/light-15926eb05714671e1f5eb979a6a709aeefc936620f110d0c80a34297ec59311c.css">
  
</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="Nathan Catania">Nathan Catania</a>
  <ul class="header-links">
    
    
      <li>
        <a href="https://www.linkedin.com/in/nathancatania" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
      <li>
        <a href="https://github.com/nathancatania" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
      <li>
        <a href="https://hub.docker.com/r/nathancatania" rel="noreferrer noopener" target="_blank" title="Docker Hub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-docker">
  <use href="/assets/docker-c339e74d6b786fbde73b16d23c150b731f34e6afba1693051596237af7ff9f2d.svg#icon-docker" xlink:href="/assets/docker-c339e74d6b786fbde73b16d23c150b731f34e6afba1693051596237af7ff9f2d.svg#icon-docker"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:hello@nathancatania.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss" xlink:href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>

        <article class="article scrollappear">
          <header class="article-header">
            <img class="article-image" src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/banner-25bc607c2b7cbebce4ac497b8d111ed330c87a88de5cbf432a801604bb9f7b2f.png">
            <h1>Deploying ZPA ZEN Connectors</h1>
            <p>These notes will cover how to deploy a ZEN Connector for Zscaler Private Access (ZPA)</p>
            <div class="article-list-footer">
              <span class="article-list-date">
                January 5, 2020
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  11 minute read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/tag/azure">azure</a>
                
                  <a href="/tag/zscaler">zscaler</a>
                
                  <a href="/tag/lab">lab</a>
                
                  <a href="/tag/notes">notes</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <blockquote>
  <p>Disclaimer: I am an employee of Zscaler. These are my own notes from a ZPA homelab deployment and may be incorrect or against best practice. You should consult the <a href="https://help.zscaler.com">Zscaler help portal</a> for official documentation.</p>
</blockquote>

<h2 id="connector-provisioning">Connector Provisioning</h2>

<p>First, we are going to define the connector in the ZPA admin portal and generate the required provisioning key. The provisioning key authenticates the connector when it calls home to the ZPA cloud (via it’s established control channel), and associates it to your ZPA instance.</p>

<p>Log into the ZPA admin portal and navigate using the side menu to <strong>Administration</strong> &gt; <strong>Connectors</strong>.</p>

<p><a href="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc1-5d779a18d569f3efe82149d312fb28243d82f206dec7cd384699dce9b2b3a110.png">
  <img src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc1-5d779a18d569f3efe82149d312fb28243d82f206dec7cd384699dce9b2b3a110.png" alt="" class="zooming" data-rjs="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc1-5d779a18d569f3efe82149d312fb28243d82f206dec7cd384699dce9b2b3a110.png" data-zooming-width="1086" data-zooming-height="559" />
</a></p>

<p>In the top-right corner, click <strong>Add Connector</strong> to open the wizard workflow.</p>

<h3 id="step-1---provisioning-key">Step 1 - Provisioning Key</h3>

<p>Create a new provisioning key, or choose an existing one if you already have one that is able to be used.</p>

<p>If you elect to use an existing key, ensure it has not reached the maximum number of uses defined or the connector connector provisioning will fail. You can alter how many times an existing key can be used under <strong>Administration</strong> &gt; <strong>Connector Provisioning Keys</strong>.</p>

<p>Click <strong>Next</strong>.</p>

<p><a href="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc2-f17ceca1ed7363d8e0bdda9e31940b7c5c86fddb1fc7df2968692bc637fa599e.png">
  <img src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc2-f17ceca1ed7363d8e0bdda9e31940b7c5c86fddb1fc7df2968692bc637fa599e.png" alt="" class="zooming" data-rjs="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc2-f17ceca1ed7363d8e0bdda9e31940b7c5c86fddb1fc7df2968692bc637fa599e.png" data-zooming-width="1723" data-zooming-height="570" />
</a></p>

<h3 id="step-2---signing-certificate">Step 2 - Signing Certificate</h3>

<p>Next choose the intermediate CA to be used to sign the identity and server certificates on the connector. When prompted, select <strong>Connector</strong>, then click <strong>Next</strong>.</p>

<p><a href="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc3-603b5a662e91c1e6f2e4087cf0e445aa472ca0c074fa469084f01d920dfe226a.png">
  <img src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc3-603b5a662e91c1e6f2e4087cf0e445aa472ca0c074fa469084f01d920dfe226a.png" alt="" class="zooming" data-rjs="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc3-603b5a662e91c1e6f2e4087cf0e445aa472ca0c074fa469084f01d920dfe226a.png" data-zooming-width="1240" data-zooming-height="374" />
</a></p>

<h3 id="step-3---connector-groups">Step 3 - Connector Groups</h3>

<p>Create a new <strong>Connector Group</strong>, or select an existing one.</p>

<p>Connector Groups are a logical grouping of connectors, and help facilitate high availability and horizontal scaling. Each connector belongs to a specific Connector Group. Connectors are updated weekly and are brought down and up again for automatic software updates on a round-robin basis within the group.</p>

<p>If creating a new group, you will need to specify a 4 hour weekly upgrade interval in which all connectors within this group will take turns automatically updating and rebooting. You will also need to specify the geographic location of the connectors in the group.</p>

<p>When you are finished, click <strong>Next</strong>.</p>

<p><a href="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc4-129d1ffde84a602243ce2c51a1ebae29a14a5197179431a06fc6803b4bee20c3.png">
  <img src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc4-129d1ffde84a602243ce2c51a1ebae29a14a5197179431a06fc6803b4bee20c3.png" alt="" class="zooming" data-rjs="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc4-129d1ffde84a602243ce2c51a1ebae29a14a5197179431a06fc6803b4bee20c3.png" data-zooming-width="1222" data-zooming-height="986" />
</a></p>

<h3 id="step-4---provisioning-key-details">Step 4 - Provisioning Key Details</h3>

<p>If in Step 1 you elected to create a NEW Provisioning Key, you will be prompted to <strong>give it a name and set the MAXIMUM number of times it can be re-used</strong> for other new connectors. This is an API enforced value, meaning it can be changed from within the ZPA admin portal (Administration &gt; Connector Provisioning Keys) at a later stage.</p>

<p>It may be worth setting a key re-usabilty value based on the number of connectors you plan on deploying in a single Connector Group. This will assist you when it comes to scaling your connectors for a specific LAN segment.</p>

<p><strong>Any connectors deployed with this Provisioning Key will be named after the key, so you’ll want to give it a descriptive name.</strong> For example, a key with the name ‘Melbourne’, will have its associated connectors automatically named <code class="highlighter-rouge">Melbourne-1</code>, <code class="highlighter-rouge">Melbourne-2</code>, and so on.</p>

<p>If you elected to use an existing key, you will be shown how many times it has already been used.</p>

<p>Click <strong>Next</strong> when ready.</p>

<p><a href="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc5-a94d2fd1a0429b5ed69b6e44eb5f4a684546ed5b0fcb115e9eab984b277a4c2f.png">
  <img src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc5-a94d2fd1a0429b5ed69b6e44eb5f4a684546ed5b0fcb115e9eab984b277a4c2f.png" alt="" class="zooming" data-rjs="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc5-a94d2fd1a0429b5ed69b6e44eb5f4a684546ed5b0fcb115e9eab984b277a4c2f.png" data-zooming-width="1221" data-zooming-height="478" />
</a></p>

<h3 id="step-5-6---review-selection-and-generate-the-provisioning-key">Step 5-6 - Review Selection and Generate the Provisioning Key</h3>

<p>Once you have reviewed the information on the <strong>Review</strong> tab, click <strong>Save</strong>.</p>

<p><strong>Your Provisioning Key will be generated and displayed.</strong></p>

<p><strong>IMPORTANT: This key is CONFIDENTIAL INFORMATION and should be stored securely.</strong> Depending on the number of times you specified the key can be re-used, anyone with your provisioning key could deploy a connector and have it associated with your Connector Group and ZPA instance. Treat it like an API key and secure it.</p>

<p>Selecting a deployment platform at the bottom of the window will load an inline help article from <code class="highlighter-rouge">help.zscaler.com</code> guiding you through the deployment process.</p>

<p><a href="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc6-b182c960e1493a58c725bf8383fe337c91a19faf1db879cb2213c6ac46c21c34.png">
  <img src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc6-b182c960e1493a58c725bf8383fe337c91a19faf1db879cb2213c6ac46c21c34.png" alt="" class="zooming" data-rjs="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc6-b182c960e1493a58c725bf8383fe337c91a19faf1db879cb2213c6ac46c21c34.png" data-zooming-width="1221" data-zooming-height="782" />
</a></p>

<h3 id="next-steps">Next Steps</h3>

<p>Click <strong>Done</strong> when you are ready.</p>

<p><strong>Only connectors that have been BOTH provisioned and enrolled will show up under Administration &gt; Connectors!</strong> We have provisioned the connector in the admin portal, but still need to deploy the connector and wait until it calls home to the ZPA cloud to enroll itself. Only then will it show in the list.</p>

<p>You can click on the <strong>Connector Groups</strong> tab or <strong>Connector Provisioning Keys</strong> tab at the top to review these details respectively.</p>

<h2 id="connector-minimum-requirements">Connector Minimum Requirements</h2>

<h3 id="requirement-1---deploy-connectors-in-pairs">Requirement 1 - Deploy Connectors in pairs</h3>

<p>Zscaler recommends you deploy connectors in pairs. Why? To ensure high-availability of your private applications.</p>

<p>As you would have specified when creating a Connector Group above, connectors have a weekly scheduled slot in which they perform an automatic software update. This causes the connector briefly go offline as it needs to reboot to complete the update process. Connectors in a group are never updated at the same time.</p>

<p>Hence, if you deploy connectors (at least) in pairs, when one connector begins to update, your applications will still be accessible through the second connector. When the first connector comes back up, the second connector will begin to update. This process repeats until all connectors in a group are updated.</p>

<h3 id="requirement-2---compute-resources-per-connector">Requirement 2 - Compute Resources per Connector</h3>

<p>Every connector has the following minimum resource requirements:</p>

<ul>
  <li>2 vCPUs</li>
  <li>4GB RAM</li>
  <li>8GB Disk (~1GB thin provisioning)</li>
  <li>1 NIC</li>
</ul>

<p>This provides each connector with a maximum throughput capacity of ~500 Mbps. If you need to scale beyond that, Zscaler recommends you deploy multiple connectors rather than simply increasing the resources allocated to the connector VM. This has an added bonus of increasing your overall resiliency to connector failure.</p>

<p>In a lab environment, you will get away with 2GB RAM allocation, but this is not supported.</p>

<h3 id="requirement-3---static-mac-address">Requirement 3 - Static MAC address</h3>

<p>The connector must have a static MAC address.</p>

<p>This is to do with the virtual hardware fingerprinting that ZPA does for connectors. MAC address is one element used to generate the unique fingerprint. If the MAC is changed at all, including on reboot, then the fingerprint will have been altered and the connector access to the ZPA cloud will be blocked for security reasons.</p>

<h3 id="requirement-4---internal-and-external-dns-resolution">Requirement 4 - Internal and External DNS Resolution</h3>

<p>The connector must be able to resolve both internal and external hostnames.</p>

<p>The connector should be deployed on the same LAN segment as the private applications it is providing access to.</p>

<h3 id="requirement-5---outbound-connectivity-on-port-443">Requirement 5 - Outbound connectivity on port 443</h3>

<p>The connector requires outbound access on port 443 in order to function. No inbound ports are required to be open.</p>

<p>For a complete list outbound firewall rules required, see https://ips.zscaler.net/zpa</p>

<h3 id="requirement-6---bypass-ssl-inspection">Requirement 6 - Bypass SSL Inspection</h3>

<p>You cannot do SSL inspection or decryption on any traffic coming from a connector. Only the Zscaler ZPA certificates are trusted. If the connector sees another certificate other than the ZPA one (due to how SSL inspection works), it will not pass traffic for security reasons.</p>

<p>You must bypass SSL inspection/decryption for connector traffic.</p>

<p>If you are using Zscaler Internet Access (ZIA), then the bypasses are automatically done for you.</p>

<h3 id="static-ips--dhcp">Static IPs &amp; DHCP</h3>

<p>Both static assignment of networking details and DHCP are supported connectors. Given that a connector is a key piece of networking infrastructure, static addressing is recommended.</p>

<h2 id="connector-deployment---vmware-vsphere-esxi">Connector Deployment - VMware vSphere (ESXi)</h2>

<p>For this guide, I’ll be using the free vSphere Hypervisor (6.7).</p>

<ol>
  <li>
    <p>Download the connector OVA using the URL below:</p>

    <p><a href="https://dist.private.zscaler.com/vms/VMware/2018.10/zpa-connector-2018.10.ova">https://dist.private.zscaler.com/vms/VMware/2018.10/zpa-connector-2018.10.ova</a></p>

    <p>If you are using vCenter, then you should be able to simply paste in the URL to the OVF deployment tool.</p>
  </li>
  <li>
    <p>Login to the vSphere UI. Select <strong>Virtual Machines</strong> from the side menu and select <strong>Create / Register VM</strong> at the top-left.</p>
  </li>
  <li>
    <p>Select option 2 <strong>Deploy a virutal machine from an OVF or OVA file</strong>, then on the next screen give the VM a name (I called mine <code class="highlighter-rouge">Z-Connector-1</code> and <code class="highlighter-rouge">Z-Connector-2</code>), and click to upload the <code class="highlighter-rouge">ZPA_Connector.ova</code> file.</p>
  </li>
</ol>

<p><a href="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/esx1-8b0527797ec085f3ff16d4409f39143ee23810e6b208fddec0b5bebb2bebd905.png">
  <img src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/esx1-8b0527797ec085f3ff16d4409f39143ee23810e6b208fddec0b5bebb2bebd905.png" alt="" class="zooming" data-rjs="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/esx1-8b0527797ec085f3ff16d4409f39143ee23810e6b208fddec0b5bebb2bebd905.png" data-zooming-width="946" data-zooming-height="603" />
</a></p>

<ol>
  <li>Select storage options, click <strong>Next</strong>, then select the network segement you wish to deploy the connector to. This should ideally be the same LAN segment that some of your applications are on.
For <strong>Disk Provisioning</strong>, leave it set to <strong>Thin</strong>.</li>
</ol>

<p><a href="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/esx3-932e0de8ed128ca1ffb510a73e86f79f74bde95aef910f28c13bc00fbf8c37b1.png">
  <img src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/esx3-932e0de8ed128ca1ffb510a73e86f79f74bde95aef910f28c13bc00fbf8c37b1.png" alt="" class="zooming" data-rjs="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/esx3-932e0de8ed128ca1ffb510a73e86f79f74bde95aef910f28c13bc00fbf8c37b1.png" data-zooming-width="944" data-zooming-height="601" />
</a></p>

<ol>
  <li>Review your settings and click <strong>Finish</strong> to deploy the OVA.</li>
</ol>

<p>If you get an <code class="highlighter-rouge">Unsupported attribute 'initialBoot' on element 'InstallSection'</code> error when deploying, try again using one one of the OVAs below:</p>

<ul>
  <li>If you are using vSphere:
<a href="https://dist.private.zscaler.com/vms/VMware/Latest/ZPA_Connector_Basic.ova">https://dist.private.zscaler.com/vms/VMware/Latest/ZPA_Connector_Basic.ova</a></li>
  <li>If you are using vCenter
<a href="https://dist.private.zscaler.com/vms/VMware/Latest/ZPA_Connector_Basic.ova">https://dist.private.zscaler.com/vms/VMware/Latest/ZPA_Connector.ova</a></li>
</ul>

<p>If you are still hitting the error, try updating your ESXi client.</p>

<h2 id="connector-configuration--housekeeping">Connector Configuration &amp; Housekeeping</h2>

<p>Here we will login to the connector, change the default password, set network information (if not obtained via DHCP), and (optionally) enable SSH.</p>

<p>We will also manually update the connector from the command line. <strong>This is highly recommended the first time you deploy a connector.</strong></p>

<p>Some of these steps may only be required if you deployed the connector as a VM, and not as a package or in AWS/Azure.</p>

<p>It may take 15 minutes for the default <code class="highlighter-rouge">admin</code> user to be created. If login to the connector initially fails, wait some time and then try again.</p>

<h3 id="change-the-default-password">Change the default password</h3>

<ol>
  <li>Log in to the connector using the <strong>username</strong> <code class="highlighter-rouge">admin</code> and <strong>default password</strong> <code class="highlighter-rouge">zscaler</code></li>
</ol>

<p><a href="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/cli1-0dc14cd95348f1b6cfa69e125514e7bcb4fd2d74ed7c0f8983202aff2f063c2a.png">
  <img src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/cli1-0dc14cd95348f1b6cfa69e125514e7bcb4fd2d74ed7c0f8983202aff2f063c2a.png" alt="" class="zooming" data-rjs="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/cli1-0dc14cd95348f1b6cfa69e125514e7bcb4fd2d74ed7c0f8983202aff2f063c2a.png" data-zooming-width="646" data-zooming-height="569" />
</a></p>

<ol>
  <li>Use the <code class="highlighter-rouge">passwd</code> command to change the current password for the <code class="highlighter-rouge">admin</code> user</li>
</ol>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">   <span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span>passwd 
   Changing password <span class="k">for </span>user admin. 
   Changing password <span class="k">for </span>admin. 
   <span class="o">(</span>current<span class="o">)</span> UNIX password:
   New password:
   Retype new password:
   passwd: all authentication tokens updated successfully. 
   <span class="o">[</span>admin@zpa-connector ~]<span class="err">$</span>
   </code></pre></figure>

<ol>
  <li>Log out of the connector when finished.</li>
</ol>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">   <span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">logout</span>
   </code></pre></figure>

<h3 id="set-network-information">Set Network Information</h3>

<p>VM based connectors are set to use DHCP by default. Alternatively, to set static information:</p>

<ol>
  <li>To set a static IP address, edit <code class="highlighter-rouge">/etc/sysconfig/network-scripts/ifcfg-eth0</code></li>
</ol>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">   <span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>nano /etc/sysconfig/network-scripts/ifcfg-eth0
   ...
   <span class="nv">DEVICE</span><span class="o">=</span><span class="s2">"eth0"</span>
   <span class="nv">BOOTPROTO</span><span class="o">=</span><span class="s2">"none"</span>
   <span class="nv">ONBOOT</span><span class="o">=</span><span class="s2">"yes"</span>
   <span class="nv">NETWORK</span><span class="o">=</span><span class="s2">"10.0.10.0"</span>
   <span class="nv">NETMASK</span><span class="o">=</span><span class="s2">"255.255.255.0"</span>
   <span class="nv">IPADDR</span><span class="o">=</span><span class="s2">"10.0.10.16"</span>
   <span class="nv">USERCTL</span><span class="o">=</span><span class="s2">"no"</span>
   </code></pre></figure>

<ol>
  <li>To set the default gateway, edit <code class="highlighter-rouge">/etc/sysconfig/network</code></li>
</ol>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">   <span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>nano /etc/sysconfig/network
   ...
   <span class="nv">NETWORKING</span><span class="o">=</span><span class="nb">yes 
   </span><span class="nv">GATEWAY</span><span class="o">=</span>10.0.10.1
   </code></pre></figure>

<ol>
  <li>To set DNS (connectors must be able to resolve internal and external hostnames), edit <code class="highlighter-rouge">/etc/resolv.conf</code></li>
</ol>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">   <span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>nano /etc/resolv.conf
   ...
   nameserver 10.0.10.2
   nameserver 10.0.10.22 
   search example.com
   </code></pre></figure>

<ol>
  <li>To set NTP servers, edit <code class="highlighter-rouge">/etc/chrony.conf</code>
These should ideally be internal NTP servers.</li>
</ol>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">   <span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>nano /etc/chrony.conf
   ...
   server 0.zscaler.pool.ntp.org iburst
   server 1.zscaler.pool.ntp.org iburst
   server 2.zscaler.pool.ntp.org iburst
   server 3.zscaler.pool.ntp.org iburst
   </code></pre></figure>

<ol>
  <li>Restart the <code class="highlighter-rouge">network</code> and <code class="highlighter-rouge">chronyd</code> services for your changes to take effect.</li>
</ol>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">   <span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl restart network
   <span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl restart chronyd
   </code></pre></figure>

<p>The Zscaler <a href="https://help.zscaler.com/zpa/connector-deployment-guide-vmware-platforms">documentation</a> has additonal information on how to:</p>

<ul>
  <li>Configure additional network interfaces</li>
  <li>Set static routes</li>
  <li>Configure the connector and/or yum to use a Proxy Server.</li>
</ul>

<h3 id="enable-ssh-temporarily-or-permanently">Enable SSH (temporarily or permanently)</h3>

<p>To <strong>temporarily</strong> enable SSH:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl start sshd</code></pre></figure>

<p>This will persist until next reboot. You can use <code class="highlighter-rouge">stop</code> in place of <code class="highlighter-rouge">start</code> to disable SSH once you are done.</p>

<p>To <strong>permanently</strong> enable SSH, also run the following command:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>sshd</code></pre></figure>

<h3 id="highly-recommended-manually-update-the-connector">[Highly Recommended] Manually Update the Connector</h3>

<p>Update the system packages:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>yum update <span class="nt">-y</span></code></pre></figure>

<p>Reboot the connector (preferred) or restart the <code class="highlighter-rouge">zpa-connector</code> service:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>reboot
OR
<span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl restart zpa-connector</code></pre></figure>

<p>The Zscaler <a href="https://help.zscaler.com/zpa/managing-deployed-connectors#upgradingtheconnectorpackage">documentation</a> covers alternative scenarios, such as updating with a proxy server, or without access to the package repository.</p>

<h3 id="view-connector-logs">View Connector Logs</h3>

<p>Use <code class="highlighter-rouge">journalctl</code> to view the logs for the <code class="highlighter-rouge">zpa-connector</code> service:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>journalctl <span class="nt">-u</span> zpa-connector
...
<span class="nt">--------</span> Connector Status:ID<span class="o">=</span>144133100000000000:Name<span class="o">=</span>Homelab Key-1:Ver<span class="o">=</span>19.65.2 <span class="nt">--------</span>
Certificate will expire <span class="k">in </span>377 days, 23 hours, 47 minutes, 38 seconds
Control connection state: fohh_connection_connected, <span class="nb">local</span>:[10.0.10.30]:53040 
remote:broker1c.syd4.prod.zpath.net...2.196]:443
RPC Messages: BrkRq <span class="o">=</span> 0, BrkRqAck <span class="o">=</span> 0|0, BindReq <span class="o">=</span> 0|0, BindReqAck <span class="o">=</span> 0, ...
Broker data connection count <span class="o">=</span> 0, backed_off connections <span class="o">=</span> 0
Data Transfer: Total ToBroker <span class="o">=</span> 0 bytes, Total FromBroker <span class="o">=</span> 0 bytes
Mtunnels: Total Created <span class="o">=</span> 0, Total Freed <span class="o">=</span> 0, Current Active <span class="o">=</span> 0, Alloc <span class="o">=</span> 0, ...
Registered apps count <span class="o">=</span> 0, alive app <span class="o">=</span> 0, passive_health <span class="o">=</span> 0, service_count <span class="o">=</span> 0, ...
Time skew: + 0.000000s
Control channel successfully connected to Zscaler Cloud
Connector- waiting <span class="k">for </span><span class="nb">time </span>synchronization
Connector- Time synchronized, Local <span class="nb">time</span> - 737.427447s <span class="o">=</span> cloud_time
zscaler-update: Zscaler software update: Currently installed version verified as 19.65.2</code></pre></figure>

<p>This can also be dumped to a file:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>journalctl <span class="nt">-u</span> zpa-connector <span class="o">&gt;</span> zpa-logs.txt</code></pre></figure>

<h3 id="start-stop-or-restart-the-connector-service">Start, Stop, or Restart the Connector Service</h3>

<p>The ZPA connector runs as a service called <code class="highlighter-rouge">zpa-connector and can be controlled via </code>systemctl`:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl start zpa-connector
<span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl stop zpa-connector
<span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl restart zpa-connector</code></pre></figure>

<p>You can also check the status of the connector service:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl status zpa-connector</code></pre></figure>

<h2 id="enrolling-the-connector">Enrolling the Connector</h2>

<p>In this section we will provide the connector with the Provisioning Key (PK) and complete its enrollment. After this step, you will see the connector listed in the admin portal.</p>

<p>You must stop the <code class="highlighter-rouge">zpa-connector</code> service first. If the connector does not detect the PK after it boots, it will only check for it again once every 24 hours.</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl stop zpa-connector</code></pre></figure>

<p>Create a file <code class="highlighter-rouge">/opt/zscaler/var/provision_key</code> with permissions <code class="highlighter-rouge">644</code>:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo touch</span> /opt/zscaler/var/provision_key
<span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo chmod </span>644 /opt/zscaler/var/provision_key</code></pre></figure>

<p>Copy the PK into the <code class="highlighter-rouge">provision_key</code> file. Make sure you encase it in double quotes <code class="highlighter-rouge">" "</code>:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo echo</span> <span class="s2">"&lt;Your-Provisioning-Key"</span> | <span class="nb">sudo tee</span> /opt/zscaler/var/provision_key</code></pre></figure>

<p>Check the key is correct:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo cat</span> /opt/zscaler/var/provision_key</code></pre></figure>

<p>Start the <code class="highlighter-rouge">zpa-connector</code> service again:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="o">[</span>admin@zpa-connector ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl start zpa-connector</code></pre></figure>

<p>Check the logs (see above) to verify enrollment progress.</p>

<h2 id="verifying-connector-status-and-health">Verifying Connector Status and Health</h2>

<p>If the connector has been enrolled successfully, you’ll now see it present in the list of connectors under <strong>Administration</strong> &gt; <strong>Connectors</strong>.</p>

<p><a href="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc7-9ff576e6c290d1162fe8be7953c4c7493d04f767dea1700b1fcd4b34045c942c.png">
  <img src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc7-9ff576e6c290d1162fe8be7953c4c7493d04f767dea1700b1fcd4b34045c942c.png" alt="" class="zooming" data-rjs="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc7-9ff576e6c290d1162fe8be7953c4c7493d04f767dea1700b1fcd4b34045c942c.png" data-zooming-width="1724" data-zooming-height="586" />
</a></p>

<p>Don’t worry if some of the fields have not populated yet.</p>

<p>You can check the health of the connector under the <strong>Dashboard</strong> &gt; <strong>Health</strong> tab.</p>

<p><a href="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc8-c2ed4a7c25d650cf0ddc0dd94f2838b8846bd601bab482259ec4afa26b3785c4.png">
  <img src="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc8-c2ed4a7c25d650cf0ddc0dd94f2838b8846bd601bab482259ec4afa26b3785c4.png" alt="" class="zooming" data-rjs="/assets/2020-01-05-deploying-zpa-zen-connectors.assets/zc8-c2ed4a7c25d650cf0ddc0dd94f2838b8846bd601bab482259ec4afa26b3785c4.png" data-zooming-width="1039" data-zooming-height="567" />
</a></p>

<p>This tab will only show healthy connectors by default.</p>

<h2 id="next-steps-1">Next Steps</h2>

<p>Congratulations! You’ve deployed your first ZPA connector!
Now go and repeat the same process for a second one so they are deployed in a pair.</p>

<p>In the next guide we’ll define some Applications in the admin portal and get them working with the connector(s).</p>


          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Deploying+ZPA+ZEN+Connectors%20-%20nathancatania.com/posts/deploying-zpa-zen-connectors" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=nathancatania.com/posts/deploying-zpa-zen-connectors" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
            <a href="https://plus.google.com/share?url=nathancatania.com/posts/deploying-zpa-zen-connectors" title="Share on Google+" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 128 128"><path d="M40.7 55.9v16.1c0 0 15.6 0 22 0C59.2 82.5 53.8 88.2 40.7 88.2c-13.3 0-23.7-10.8-23.7-24.2s10.4-24.2 23.7-24.2c7.1 0 11.6 2.5 15.8 5.9 3.3-3.3 3.1-3.8 11.6-11.9 -7.2-6.6-16.8-10.6-27.4-10.6C18.2 23.3 0 41.5 0 64c0 22.5 18.2 40.7 40.7 40.7 33.6 0 41.8-29.3 39-48.8H40.7zM113.9 56.7V42.6h-10.1v14.1H89.4v10.1h14.5v14.5h10.1V66.8H128V56.7H113.9z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://nathancatania.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
  <p>
    &copy; 2020, Nathan Catania<br>
    <small>Created with Jekyll using a modified version of the <a href="https://github.com/nielsenramon/chalk" rel="noreferrer noopener" target="_blank" title="Chalk">Chalk</a> theme.</small>
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-91639797-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-91639797-1');
  </script>


<script src="/assets/vendor-a17007ee4932127a9a9d73085a673502b9a053b59724ab37b9725f9081083c91.js" type="text/javascript"></script>


  <script src="/assets/webfonts-bd1108a48273b097bc65b46c563e1992ee938e8e2232393c7fe5ea4abcf80536.js" type="text/javascript"></script>



  <script src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js" type="text/javascript"></script>


<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>

</body>
</html>
